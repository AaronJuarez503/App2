<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../stylesheets/shi.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Document</title>
</head>
<body>
    <div id="toastNotificacion" class="toast">No es dia para realizar peidodos regresa otro dia </div>
   
      <!--empesas aca-->
    <h1 class="product">Productos</h1>
<div id="mio">

      
   

    


</div>
    <style>
        #carrito-icono {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 30px;
            cursor: pointer;
            z-index: 1000;
            color: rgb(137, 139, 141);
        }
        .float-div {
            position: fixed;
            top: 50px;
            right: 20px;
            background-color: #0000008e;
            color: #fff;
            padding: 10px;
            border-radius: 12px;
            z-index: 999;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        .float-div h3 {
            margin-top: 0;
        }
        .cart-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .item-image {
            width: 50px;
            height: 50px;
            background-size: cover;
            background-color: #363636;
            background-position: center;
            margin-right: 10px;
        }
        .item-info {
            flex-grow: 1;
        }
        .item-name {
            font-weight: bold;
        }
        .item-price {
            font-size: 14px;
        }
        .item-quantity {
            font-size: 12px;
        }
        .remove-item {
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
        }
        .close-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        #realizar-compra {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #0c5a7e;
            color: white;
            text-align: center;
            text-decoration: none;
            margin-top: 10px;
            border-radius: 8px;
            cursor: pointer;
        }
        #realizar-compra:hover{
            background-color: rgba(143, 1, 72, 0.438);
        }
        #total-carrito {
            display: inline-block;
            width: 35%;
            padding: 10px;
            text-align: center;
            margin-top: 10px;
        }
    </style>

    <div id="carrito-icono">
        <i class="fas fa-shopping-cart"></i>
        <span id="contador-carrito">0</span>
    </div>
    <div class="float-div">
        <span class="close-btn">&times;</span>
        <h3>Carrito de Compras</h3>
        <div id="cart-items">

           
        </div>

        
        <a href="#" id="realizar-compra">Realizar Compra</a>
        <span id="total-carrito">Total: $0</span>
    </div>

    <!-- Ejemplo de productos -->

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    
    <script>
        $(function() {

var $id = "<%= mensaje %>";
var $img = "<%= imagen %>";
console.log("Mensaje del servidor:",$id+$img);
localStorage.setItem('id',$id)


const fechaActual = new Date();


const indiceDia = fechaActual.getDay();

const diasSemana = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];

const diaSemana = diasSemana[indiceDia];







//


$.ajax({
    url: `/users/product?productoId=${$id}`,
    method: 'GET',
    dataType: 'json',
    success: function(data) {
        console.log('Datos recibidos:', data);


        function agregarNuevoProducto(producto) {
        var html = `
        <div class="card">
            <div class="imgBx" style="background-image: url(${producto.imagen});"></div>
            <div class="content">
                <h3 id="nombre">${producto.nombre}<br><span id="precio" >$${producto.precio}</span></h3>
                <p>${producto.descripcion}
                </p>
                <div class="add-to-cart">
                    <button data-id_m=${producto.marca_id} data-id=${producto.id} data-mmarca=${producto.imagen_marca} id="btn">  Agregar al carrito</button>
                </div>
            </div>
        </div>
        `;
        $('#mio').append(html);

       // $('#cart-items').append(html);
    }
        






        data.forEach(function(item) {
            agregarNuevoProducto(item);
           
            
        })

        // Elimina la tarjeta original si no deseas mantenerla
       
    }
});

$.ajax({
    url: `/users/habilitado?marca=${$id}&dia=${'jueves'}`,
    method: 'GET',
    dataType: 'json',
    success: function(data) {
        console.log('dato resibido:'+ data)

        if( data ===false){
            console.log('dia bloqueado')
           $('#mio button').each(function(index) {
            const currentId = $(this).attr('id');
           $(this).attr('id', 'btns');
           $(this).text('üîí')
           
           let lista = JSON.parse(localStorage.getItem('carrito')) || [];
          

            // Eliminar elementos donde marca es 4
            for (let i = lista.length - 1; i >= 0; i--) {
            if (lista[i].marca === parseInt(localStorage.getItem('id'),10)) {
            lista.splice(i, 1);
            }
            }
            localStorage.setItem('carrito', JSON.stringify(lista));

          


            // Cambia el id a "btns0", "btns1", etc.
    });
    

        }

    },
    error: function(xhr, status, error) {
        console.error('Error en la petici√≥n AJAX:', error);
        $('#resultado').html('Error al cargar los datos');
    }
})



});
    </script>
    

    <script>
      $(document).ready(function() {
      
    //let list = [];

    //let list = JSON.parse(localStorage.getItem('carrito')) || [];

    // function guardarCarritoEnLocalStorage() {
    //     localStorage.setItem('carrito', JSON.stringify(list));
    // }

    // Mostrar/ocultar carrito
    $('#carrito-icono').click(function() {
        $('.float-div').toggle();
    });

    // Cerrar el carrito
    $('.close-btn').click(function() {
        $('.float-div').hide();
    });

   

    // //Agregar producto al carrito
    // $('#mio').off('click', '#btn').on('click', '#btn', function() {
    //     var container = $(this).closest(".card");
    //     var headingContent = container.find("h3").text();

    //     var id = $(this).data('id');
    //     var id_marca = $(this).data('id_m');
    //     var imagen = $(this).data('mmarca');

    //     console.log(id,':',id_marca,':',imagen)


    //     const partes = headingContent.split('$');
    //     const nombre = partes[0].trim(); // Eliminar espacios al final
    //     const numeros = partes[1];
    //     console.log(nombre,':',numeros)
        
          

    //     var imageUrl = container.find('.imgBx').css("background-image").replace(/url\("?|"?\)$/g, '');
       
      
        
    //     var precio = parseFloat(numeros);

    //     var datos = {
    //         id:id,
    //         marca:id_marca,
    //         mmarca:imagen,
    //         nombre: nombre,
    //         imagen: imageUrl,
    //         precio: precio,
    //         cantidad: 1,
    //         total: precio
           
    //     };

    //     localStorage.setItem('carrito', JSON.stringify(datos));

    //     let productoExistente = list.find(item => item.id === datos.id);

    //     if (productoExistente) {
    //         productoExistente.cantidad++;
    //         productoExistente.total = productoExistente.precio * productoExistente.cantidad;
            
    //         actualizarCantidadEnUI(productoExistente);
    //     } else {
    //         list.push(datos);
    //         agregarNuevoProductoAUI(datos);
    //     }
    //     guardarCarritoEnLocalStorage();

    //     actualizarContadorCarrito();
    //     actualizarTotalCarrito();
    //     $('#contador-carrito').css('color', 'red');
    // });

    // function actualizarCantidadEnUI(producto) {
    //     var $item = $(`.cart-item[data-nombre="${producto.nombre}"]`);
    //    // $item.find('.item-quantity').text(`Cantidad: ${producto.cantidad}`);
    //     $item.find('.item-price').text(`$${producto.total.toFixed(2)}`);
    //     var $item = $(`.counter[data-nombre="${producto.nombre}"]`);
    //     $item.find('#number').val(`${producto.cantidad}`);
    // }

    function agregarNuevoProductoAUI(producto) {
        var html = `
            <div class="cart-item" data-nombre="${producto.nombre}">
                <div class="item-image" style="background-image: url('${producto.imagen}')"></div>
                <div class="item-info">
                    <div class="item-name">${producto.nombre}</div>
                    <div class="item-price">$${producto.total.toFixed(2)}</div>

                </div>
                 <div class="counter" data-nombre="${producto.nombre}" >
                    <button id="men" data-id="${producto.id}" >&#8722;</button>
                    <input type="text" id="number" value="${producto.cantidad}" readonly>
                    <button id="man" data-id="${producto.id}" >&#43;</button>
                </div>
                <span class="remove-item">√ó</span>
            </div>
        `;
        $('#cart-items').append(html);
        
    }

    // Eliminar producto del carrito
    $(document).on('click', '.remove-item', function() {
        var nombreProducto = $(this).closest('.cart-item').data('nombre');
        list = list.filter(item => item.nombre !== nombreProducto);
        $(this).closest('.cart-item').remove();
        guardarCarritoEnLocalStorage();
        actualizarContadorCarrito();
        actualizarTotalCarrito();
    });

    function actualizarContadorCarrito() {
        let totalItems = list.reduce((sum, item) => sum + item.cantidad, 0);
        $('#contador-carrito').text(totalItems);
        if (totalItems === 0) {
            $('#carrito-icono').css('color', 'black');
        }
    }

    function actualizarTotalCarrito() {
        let totalCarrito = list.reduce((sum, item) => sum + item.total, 0);
        $('#total-carrito').text(`Total: $${totalCarrito.toFixed(2)}`);
    }
    $('#realizar-compra').click(function(e) {
           
            if (list.length > 0) {
                $.ajax({
            url: '/users/procesar-compra',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ items: list }),
            success: function(response) {
                // Redirige a la p√°gina de confirmaci√≥n
                window.location.href = '/users/confirmacion-compra';
            },
            error: function(error) {
                console.error('Error al procesar la compra:', error);
                alert('Hubo un error al procesar tu compra. Por favor, int√©ntalo de nuevo.');
            }
        });
                
            } else {
                alert("El carrito est√° vac√≠o.");
            }
        });

        function cargarCarritoDesdeLocalStorage() {
        list.forEach(producto => {
                agregarNuevoProductoAUI(producto);
            });
            actualizarContadorCarrito();
            actualizarTotalCarrito();
        }

        cargarCarritoDesdeLocalStorage();

        //menos mas

        function actualizarCantidad(id, incremento) {
            let producto = list.find(p => p.id === id);
            if (producto) {
                producto.cantidad += incremento;
                producto.total = producto.precio * producto.cantidad;
                actualizarCantidadEnUI(producto);
                if (producto.cantidad < 1) {
                 producto.cantidad = 1; // Asegura que la cantidad no baje de 1
                 producto.total = producto.precio * producto.cantidad;
                 actualizarCantidadEnUI(producto);
                 actualizarTotalCarrito();
                }
                producto.total = producto.cantidad * producto.precio;
                actualizarCantidadEnUI(producto);
                guardarCarritoEnLocalStorage();
                actualizarTotalCarrito();
            }
            }

            // Incrementar cantidad del producto con id 2
            

            // Decrementar cantidad del producto con id 3
            

        $('#cart-items').off('click', '#men').on('click', '#men', function() {
            var id = $(this).data('id');
            console.log(id)
            actualizarCantidad(id, -1);
           
        })
        $('#cart-items').off('click', '#man').on('click', '#man', function() {
            var id = $(this).data('id');
            console.log(id)
            actualizarCantidad(id, 1);
            
})
});
  
    </script>

<script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
<script>
var swipeArea = document.getElementById('swipeArea');
    
    // Crea una instancia de Hammer en el √°rea seleccionada
    var hammer = new Hammer(document.body);


    // Escucha el evento de deslizamiento hacia la derecha
    hammer.on('swiperight', function(event) {
    // C√≥digo para manejar el deslizamiento hacia la derecha
    console.log('Deslizamiento hacia la derecha detectado');
    window.location.href = '/marca'
        
 
    
});
</script>
<script src="/javascript/bloquear.js""></script>
<script src="/javascript/Carrito.js" ></script>
    <script src="/javascript/productos.js"></script>
    
  
<style>
    #btns {
        font-size: 34PX;
        background-color: #1c2124;
    }

</style>
<style>
    .toast {
      visibility: hidden;
      min-width: 250px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 2px;
      padding: 16px;
      position: fixed;
      z-index: 1;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
    }

    .toast.mostrar {
      visibility: visible;
      animation: fadeIn 0.5s, fadeOut 0.5s 2.5s;
    }

    @keyframes fadeIn {
      from {
        top: 0;
        opacity: 0;
      }
      to {
        top: 30px;
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        top: 30px;
        opacity: 1;
      }
      to {
        top: 0;
        opacity: 0;
      }
    }
  </style>


    
</body>
</html>